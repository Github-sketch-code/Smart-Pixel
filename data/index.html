<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<!-- <link rel="stylesheet" href="navstyle.css"/> -->
    	<link rel="icon" type="image/png" href="fav.png" size="32x32"/>
    	<title>Light is Power</title>

		<div id="menuToggle">
			<!--
			 Eine Checkbock als Click empfaenger fuer den Menu Button
			-->
			<input type="checkbox" />
			<!--
			 Ein paar Spans fur das Menu
			-->
			<span></span>
			<span></span>
			<span></span>
			<!--
			Menu "in" der Checkbox
			-->
			<ul id="menu">
			  <a href="#"><li>Home</li></a>    <!--Hier soll sich Temperatur/Luftfeuchte der RGB Regler : EINE SCHLICHTE SEITE befinden-->
			  <a href="#"><li>Reminder</li></a>
			  <a href="#"><li>Switches</li></a>
			  <a href="#"><li>About</li></a>
			  <a href="#" target="_blank"><li>Support</li></a>
			</ul>
		</div>
		<h1 style="text-align: center; color:rgb(180, 118, 118)">Micro Rainbow</h1>
		<hr>
		<p id="MidText">
		  Temperature & Humidity
		  <br/>
		  Color Mixer
		</p>

		<hr>
	</head>
	<body>
		<h2>RGB</h2>
		<form method="POST" oninput="sendRGB();">
			Farbe<input id="RGB-Color" type="color" name="RGB-Color"/>
		</form>
		<hr/>
		<h2>Effekte</h2>
		<form method="POST" onchange="sendEffekte();">
			<input type="radio" class="Effekte" name="Effekt" id="Blink" value="Blink"/>Blink
			<br/>
			<input type="radio" class="Effekte" name="Effekt" id="RainbowCycle" value="RainbowCycle"/>RainbowCycle
			<br/>
			<input type="radio" class="Effekte" name="Effekt" id="ColorWipe" value="ColorWipe"/>ColorWipe
			<br/>
			<input type="radio" class="Effekte" name="Effekt" id="Nothing" value="Nothing"/>Nothing
			<br/>
			Effekt-Speed<input id="EffektSpeed" name="EffektSpeed" type="range" min="1" max="100"/>
		</form>
		<hr/>
		<h2>Temp-Hum-Sensor</h2>
		<p>Temperature: <span id="Temperature">%TEMP%</div></p>
		<p>Humidity: <span id="Humidity">%HUM%</div></p>
		<hr/>
		<h2>Relay</h2>
		<form method="POST">
			<input type="button" onclick="sendRelay();" id="Relay0" value="%NAME%">
		</form>
		<hr/>
		<h2>Pir-Sensor</h2>
		<form method="POST" onclick="sendPirSensor();">
			<p id="Pir-Sensor" style="height: 5em; width: 5em; background-color:green; border-radius: 0.7em;"></p>
			<input type="button" name="resetPir" name="Reset" value="Reset">
		</form>
		<hr/>
		<h2>Einstellungen</h2>
		<form method="POST">
			Eigenes WiFi erzeugen:<input id="WiFiAccessPointMode" type="checkbox" name="WiFiAccessPointMode"/>
			<br/>
			WiFi-Name:<input id="WiFi-Name" type="text" name="WiFi-Name" minlength="8" maxlength="12"/>
			<br/>
			WiFi-Passwort:<input id="WiFi-Passwort" type="text" name="WiFi-Passwort" minlength="8" maxlength="12"/>
			<br/>
			Hostname/Domain:<input id="Hostname" type="text" name="Hostname" minlength="1" maxlength="12"/>
			<br/>
			max. Anzahl an Clients:<input id="MaxConnections" type="number" min="1" max="8" name="MaxConnections"/>
			<br/>
			<input type="submit" value="Abschicken"/>
		</form>
	</body>

	<!-- https://code-boxx.com/submit-form-without-refreshing-page/ -->
	<script>
		document.getElementById("WiFiAccessPointMode").value = true;
		// WebSocket-Initialization
			var Socket = new WebSocket("ws://" + location.hostname + ":81/", ["arduino"]);
			Socket.onopen = function() { Socket.send("Connect " + new Date()); }
			Socket.onerror = function (error) { console.log("WebSocket Error ", error); }
			Socket.onmessage = function (sendData) {
				var splitPosFirst = sendData.data.indexOf(":");
				var splitPosSecond = sendData.data.indexOf(":", splitPosFirst + 1);
				var splitPosLast = sendData.data.lastIndexOf(":");

				var aim = sendData.data.substring(0, splitPosFirst);
				var aimType = sendData.data.substring(splitPosFirst + 1, splitPosSecond);
				var argName = sendData.data.substring(splitPosSecond + 1, splitPosLast);
				var arg = sendData.data.substring(splitPosLast + 1);
				
				/*
				alert(sendData);
				alert(aim);
				alert(aimType);
				alert(argName);
				alert(arg);
				*/

				console.log(aim);
				console.log(aimType);
				console.log(argName);
				console.log(arg);
				if(aim == "Form") {
					if(aimType == "radio" || aimType == "checkbox") {
						document.getElementById(argName).checked = arg;
					} else {
						document.getElementById(argName).value = arg;
					}
				} else if(aim == "HTML") {
					if(aimType == "innerHTML") {
						document.getElementById(argName).innerHTML = arg;
					}
				} else if(aim == "CSS") {
					if(argName == "Pir-Sensor") {
						if(aimType == "backgroundColor") {}
						document.getElementById("Pir-Sensor").style.backgroundColor = arg;
					}
				} else { }
				//document.getElementById("Humidity").innerHTML = sendData.data;
				//document.getElementById("Debug").value += sendData.data;
				//console.log("Server: ", sendData.data());
			}
			Socket.onclose = function () { console.log('WebSocket connection closed'); };
		// WebSocket-Initialization

		function websocketSend(argName, arg) {
			var sendString = argName + ":" + arg;
			console.log(sendString);
			Socket.send(sendString);
		}

		function sendRelay() {
			var relays = document.getElementsByClassName("Relay");
			for(var relayToChange of relays) {
			}
			var relayNum = 0;
			websocketSend("Relay", "0");
		}
		function sendPirSensor() {
			websocketSend("PirSensor", "reset");
		}
		function sendRGB() {
			var rgb = document.getElementById("RGB-Color").value;
			//alert(rgb)
			//console.log("RGB: " + rgb);
			//Socket.send(rgb);
			websocketSend("RGB-Color", rgb);
		}
		function sendEffekte() {
			// https://www.techiedelight.com/get-value-of-selected-radio-button-javascript/ - 2. JavaScript
			var radios = document.getElementsByClassName("Effekte");
			for (var checked_radio of radios) {
				if(checked_radio.checked) {
					//alert(checked_radio.value);
					websocketSend("Effekt", checked_radio.value);
				}
			}
			var effektSpeed = document.getElementById("EffektSpeed").value;
			websocketSend("EffektSpeed", effektSpeed);
			//alert(effekt);
		}
	</script>
</html>