<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<!--<link rel="stylesheet" href="navstyle.css"/>-->
    	<link rel="icon" type="image/png" href="fav.png" size="32x32"/>
    	<title>Light is Power</title>

		<div id="menuToggle">
			<!--
			 Eine Checkbock als Click empfaenger fuer den Menu Button
			-->
			<input type="checkbox" />
			<!--
			 Ein paar Spans fur das Menu
			-->
			<span></span>
			<span></span>
			<span></span>
			<!--
			Menu "in" der Checkbox
			-->
			<ul id="menu">
			  <a href="index.html"><li>Home</li></a>    <!--Hier soll sich Temperatur/Luftfeuchte der RGB Regler : EINE SCHLICHTE SEITE befinden-->
			  <a href="#"><li>Reminder</li></a>
			  <a href="#"><li>Switches</li></a>
			  <a href="#"><li>About</li></a>
			  <a href="#" target="_blank"><li>Support</li></a>
			</ul>
		</div>
		<h1 id="top" style="text-align: center; color:rgb(180, 118, 118);">Micro Rainbow</h1>

		<hr />
	</head>
	<body>
		<div class="container">
		<h2>Color Mixer</h2> <!-- Preview has to overlap to the right to prevent covering the lower containers -->
		<form method="POST" onchange="sendRGB();">
			Farbe
			<br />
			<input id="RGB-Color" type="color" name="RGB-Color"/>			
		</form>
	    </div>

		<hr/>

		<div class="container">
		<h2>Effekte Panel</h2> <!-- Should look more atractive -->
		<form method="POST" onchange="sendEffekte();">
			<input type="radio" class="Effekte" name="Effekt" id="Blink" value="Blink"/>Blink
			<br/>
			<input type="radio" class="Effekte" name="Effekt" id="RainbowCycle" value="RainbowCycle"/>RainbowCycle
			<br/>
			<input type="radio" class="Effekte" name="Effekt" id="ColorWipe" value="ColorWipe"/>ColorWipe
			<br/>
			<input type="radio" class="Effekte" name="Effekt" id="Nothing" value="Nothing"/>Nothing
			<br/>
			 Effekt Speed
			 <br />
			<input id="EffektSpeed" name="EffektSpeed" type="range" min="1" max="100"/>
		</form>
	    </div>

		<hr/>

		<div class="container">
		<h3>Sensor Panel</h3> <!-- Should look like sensors=> Thermometer, Waterdrop ... -->
		<p>Temperature: <span id="Temperature">%TEMP%</span></p>
		<p>Humidity: <span id="Humidity">%HUM%</span></p>
		</div>
		<hr/>
		

		<div class="container">
		<h3>Smart Switch</h3> <!--It should look like a switch-->
		<form method="POST">
			<input class="button" type="button" onclick="sendRelay();"  id="Relay0" value="%NAME%"/>
		</form>
		</div>

		<hr/>
        
		<div class="container">
		<h2>Motion Detector</h2>  <!--Here should be the running man like Mr. X-->
		<form method="POST" onclick="sendPirSensor();">
			<p id="Pir-Sensor" style="height: 5em; width: 5em; background-color:green; border-radius: 0.7em;"></p>
			<!-- <img src="MotionHand2.png" style="background-color:transparent;" /> -->
			 <!--Background auf rgb(219, 219, 38); aendern wenn getriggert-->    <br />
			<input class="button" type="button" name="Reset" value="Reset">
		</form>
	    </div>

		<hr/>

		<div class="container">
		<h2>Einstellungen</h2>
		<form>
			<table cellpadding="5px">
				<colgroup>
					<col width="30%"/>
					<col width="30%"/>
				</colgroup>
				<tr>
					<td>Eigenes WiFi erzeugen</td>
					<td><input id="WiFiAccessPointMode" type="checkbox" name="WiFiAccessPointMode"/></td>
				</tr>
				<tr>
					<td>WiFi-Name</td>
                    <td><input id="WiFi-Name" type="text" name="WiFi-Name" minlength="8" maxlength="12"/></td>
				</tr>
				<tr>
					<td>WiFi-Passwort</td>
					<td><input id="WiFi-Passwort" type="text" name="WiFi-Passwort" minlength="8" maxlength="12"/></td>
				</tr>
				<tr>
					<td>Hostname/Domain</td>
					<td><input id="Hostname" type="text" name="Hostname" minlength="1" maxlength="12"/></td>
				</tr>
				<tr>
					<td>Anzahl an Clients</td>
					<td><input id="MaxConnections" type="number" min="1" max="8" name="MaxConnections" title="Maximale Anzahl an Clients, die sich mit dem Wlan verbinden koennen(ist nur Einstellbar wenn 'Eigenes WiFi erzeugen' aktiviert ist)"/></td>
				</tr>
				<tr></tr>
				<tr>
					
					<!-- <button onclick="SendWiFiSettings(); return false;">Abschicken</button> -->
				</tr>
			</table>
			<input class="button" type="button" value="Abschicken" onclick="SendWiFiSettings();">
		</form>
      </div>
	<div id="bottom">
		<hr >
		<footer >
			&copy; By _____ and _____
		</footer>
	</div>
	</body>

	<!-- https://code-boxx.com/submit-form-without-refreshing-page/ -->
	<script>
		document.getElementById("WiFiAccessPointMode").value = true;
		// WebSocket-Initialization
			var Socket = new WebSocket("ws://" + location.hostname + ":81/", ["arduino"]);
			Socket.onopen = function() { console.log("Verbindung " + new Date()); }
			Socket.onclose = function() {
				console.log("WebSocket Verbindung getrennt");
				alert("Verbindung zu Server getrtennt! Daten koennen nicht mehr im Hintergrund aktualisiert werden - Website neuladen(reload)");
			}
			Socket.onerror = function(error) {
				console.log("Websocket Fehler ", error);
				alert("Fehler bei der Verbindung zum Server! Daten koennen nicht im Hintergrund aktualisiert werden - Website neuladen(reload)");
			}

			Socket.onmessage = function (sendData) {
				var splitPosFirst = sendData.data.indexOf(":");
				var splitPosSecond = sendData.data.indexOf(":", splitPosFirst + 1);
				var splitPosLast = sendData.data.lastIndexOf(":");

				var aim = sendData.data.substring(0, splitPosFirst);
				var aimType = sendData.data.substring(splitPosFirst + 1, splitPosSecond);
				var argName = sendData.data.substring(splitPosSecond + 1, splitPosLast);
				var arg = sendData.data.substring(splitPosLast + 1);
				
				/*
				alert(sendData);
				alert(aim);
				alert(aimType);
				alert(argName);
				alert(arg);
				*/

				console.log(aim);
				console.log(aimType);
				console.log(argName);
				console.log(arg);
				if(aim == "Form") {
					if(aimType == "radio" || aimType == "checkbox") {
						document.getElementById(argName).checked = arg;
					} else {
						document.getElementById(argName).value = arg;
					}
				} else if(aim == "HTML") {
					if(aimType == "innerHTML") {
						document.getElementById(argName).innerHTML = arg;
					}
				} else if(aim == "CSS") {
					if(argName == "Pir-Sensor") {
						if(aimType == "backgroundColor") {}
						document.getElementById("Pir-Sensor").style.backgroundColor = arg;
					}
				} else { }
				//document.getElementById("Humidity").innerHTML = sendData.data;
				//document.getElementById("Debug").value += sendData.data;
				//console.log("Server: ", sendData.data());
			}
		// WebSocket-Initialization

		function websocketSend(argName, arg) {
			var sendString = argName + ":" + arg;
			console.log(sendString);
			Socket.send(sendString);
		}

		function sendRelay() {
			var relays = document.getElementsByClassName("Relay");
			for(var relayToChange of relays) {
			}
			var relayNum = 0;
			websocketSend("Relay", "0");
		}
		function sendPirSensor() {
			websocketSend("PirSensor", "reset");
		}
		function sendRGB() {
			var rgb = document.getElementById("RGB-Color").value;
			//alert(rgb)
			//console.log("RGB: " + rgb);
			//Socket.send(rgb);
			websocketSend("RGB-Color", rgb);
		}
		function sendEffekte() {
			// https://www.techiedelight.com/get-value-of-selected-radio-button-javascript/ - 2. JavaScript
			var radios = document.getElementsByClassName("Effekte");
			for (var checked_radio of radios) {
				if(checked_radio.checked) {
					//alert(checked_radio.value);
					websocketSend("Effekt", checked_radio.value);
				}
			}
			var effektSpeed = document.getElementById("EffektSpeed").value;
			websocketSend("EffektSpeed", effektSpeed);
		}
		function SendWiFiSettings() {
			var WiFiAccessPointMode = document.getElementById("WiFiAccessPointMode").checked == true ? "1" : "0";
			var WiFiName = document.getElementById("WiFi-Name").value;
			var WiFiPasswort = document.getElementById("WiFi-Passwort").value;
			var Hostname = document.getElementById("Hostname").value;
			var maxConnections = document.getElementById("MaxConnections").value;

			websocketSend("WiFiAccessPointMode", WiFiAccessPointMode);
			websocketSend("WiFi-Name", WiFiName);
			websocketSend("WiFi-Passwort", WiFiPasswort);
			websocketSend("MaxConnections", maxConnections);
			websocketSend("Hostname", Hostname);
			websocketSend("Command", "writeSpiffsConfigs");
		}
	</script>
</html>